work_type: incremental_milestone
branch_name: 2025-12-06-g12a-column-block-move
target_subsystem: grid_diff

milestone:
  parent_phase: "Phase 4 – Spreadsheet-mode advanced alignment"
  parent_milestone: "G12 – Column / rectangular block move"
  incremental_milestone: "G12a – Exact column block move (small grids)"

rationale:
  - Current grid diff implementation has reached G11: row/column alignment (G8–G9), row block insert/delete (G10), and exact row block move detection (G11) are in place and tested, including a dedicated RowBlockMove detector and workbook-level fixtures. 
  - The DiffOp layer and JSON schema already define BlockMovedColumns and have shape/round-trip tests, but the engine never emits this variant; G12’s column-move behavior is therefore unimplemented despite having IR support. 
  - The testing plan calls out G12 as the next spreadsheet-mode alignment milestone (column and rectangular block moves). Implementing the column-move half first gives concrete progress toward this milestone while keeping the cycle small and testable. :contentReference[oaicite:2]{index=2}
  - Column block moves are a visible product differentiator (cleanly recognizing moved columns instead of noisy delete+add) and directly support the “high‑performance 2D grid diff” hurdle (H1) in the difficulty analysis and the move-detection emphasis in the unified grid diff spec. 
  - The existing GridView and HashStats infrastructure, plus the row-block move detector, provide a clear implementation template for an exact column-block move detector with similar guards (size bounds, repetition, ambiguity rejection), keeping conceptual and implementation risk moderate for a single cycle. 

risks_of_deferral:
  - Column moves will continue to appear as ColumnRemoved + ColumnAdded (and possibly many CellEdited ops), producing noisy and confusing diffs for a very common user action (reordering columns in financial or tabular models).
  - BlockMovedColumns will remain an unused DiffOp variant; bugs in its JSON schema or future consumers could go unnoticed until much later, when the system is more complex and regressions are harder to isolate. :contentReference[oaicite:5]{index=5}
  - Rectangular move detection (the rest of G12) and later fuzzy move detection (G13) both benefit from having simple, exact column-move detection in place; postponing this step pushes more of the H1 risk into a single larger future cycle. 
  - Database-mode alignment (D1–D4) also relies on robust column/structure semantics; leaving column moves unmodeled can complicate reasoning about how spreadsheet-mode and database-mode semantics compose at the sheet boundary. 

references:
  - docs/rust_docs/excel_diff_testing_plan.md (Spreadsheet-mode advanced alignment, G8–G13; database-mode D1–D4) :contentReference[oaicite:8]{index=8}
  - docs/rust_docs/unified_grid_diff_algorithm_specification.md (grid diff pipeline, move detection cases, UC-11/UC-13) 
  - docs/rust_docs/excel_diff_specification.md (high-level grid diff overview, spreadsheet vs database modes) :contentReference[oaicite:10]{index=10}
  - docs/rust_docs/excel_diff_difficulty_analysis.md (H1 – high‑performance 2D grid diff engine) :contentReference[oaicite:11]{index=11}
  - docs/rust_docs/excel_diff_product_differentiation_plan.md (move detection as a differentiator) :contentReference[oaicite:12]{index=12}
  - core/src/engine.rs (diff_grids pipeline: row block move, row alignment, column alignment, positional diff) :contentReference[oaicite:13]{index=13}
  - core/src/column_alignment.rs (column metadata, HashStats, and size/repetition guards used for G9) :contentReference[oaicite:14]{index=14}
  - core/tests/g11_row_block_move_grid_workbook_tests.rs (row block move behavior and ambiguity guard) :contentReference[oaicite:15]{index=15}
  - fixtures/manifest.yaml (Phase 4 G8–G11 entries; place to add G12 fixtures) 

difficulty_estimate: 6
difficulty_reference: "10 = H1. High-performance 2D grid diff engine (rows/columns, block moves, database mode)."