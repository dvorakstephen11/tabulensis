work_type: milestone_progress
branch_name: 2025-12-06c-g12-rect-block-move
target_subsystem: grid_diff_rectangular_block_moves

rationale:
  - Phase 4 milestone G12 explicitly calls for both column and rectangular block move detection; the codebase and tests currently cover column block moves (G12a) but not the rectangular case. 
  - The unified grid diff spec defines a dedicated BlockMovedRect operation as part of the move taxonomy, but the current DiffOp enum only exposes row and column block move variants. Adding BlockMovedRect now aligns implementation with the design while the grid diff surface is still relatively small. 
  - Exact row block moves (G11) and column block moves (G12a) have just landed, along with the GridView/HashStats preprocessing layer and alignment helpers; implementing rectangular block moves now lets us reuse these primitives while they are fresh and before fuzzy move detection (G13) adds more complexity. 
  - Rectangular block moves are part of the H1 “high‑performance 2D grid diff” hurdle and a core differentiation in the product roadmap (“full block-level moves – rows, columns, rectangles – with fuzzy matching”), so closing the gap on exact rectangles is directly on the critical path. 
  - This cycle can be scoped tightly: introduce BlockMovedRect in DiffOp + PG4 serialization tests, add a single G12 rectangular workbook scenario, and wire a conservative detection path that runs only when cheap and unambiguous.

risks_of_deferral:
  - Rectangular cut/paste operations will continue to degrade into noisy CellEdited streams, undermining the “block move aware” positioning and leaving G12 only partially implemented (columns but not rectangles). 
  - Fuzzy move detection (G13) and later performance work (P1/P2) are easier to reason about when exact rectangular moves already have a clear representation and detection path; deferring this increases coupling and rework when integrating LAPJV-based fuzzy moves. 
  - Adding a new public DiffOp variant later, after more CLI/JSON consumers exist, raises the risk of wire‑format churn and harder compatibility work; landing BlockMovedRect while only PG4 and early consumers exist keeps this change low-risk. 
  - Without rectangular move tests, the engine has no guardrail against accidentally “detecting” bogus rectangles in repetitive grids; we’d be blind to a class of correctness and stability bugs in a high-difficulty subsystem (H1). 

references:
  - docs/rust_docs/excel_diff_testing_plan.md – Phase 4, G12 column/rectangular block move, D1 status. :contentReference[oaicite:8]{index=8}
  - docs/rust_docs/unified_grid_diff_algorithm_specification.md – move taxonomy, BlockMovedRect, operation assembly. 
  - docs/rust_docs/excel_diff_specification.md – diff pipeline overview, grid vs database mode. 
  - docs/rust_docs/excel_diff_difficulty_analysis.md – H1 difficulty (high-performance 2D grid diff engine). :contentReference[oaicite:11]{index=11}
  - docs/meta/reviews + development_history.txt – prior cycles for PG5, G8–G12a, D1 (row/column alignment, block moves, database mode keyed equality). 

difficulty_estimate: 6
difficulty_scale_max:
  value: 10
  milestone: H1-full-grid-diff-coverage-phase4-G8-G13-D1-D10