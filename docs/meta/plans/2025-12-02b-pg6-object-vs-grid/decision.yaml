branch: 2025-12-02-pg6-object-vs-grid
work_type: milestone_progress
target_subsystem: workbook_diff_engine_pg6_object_vs_grid

rationale:
  - PG6 ("Object graph vs grid responsibilities") is the next unimplemented spreadsheet milestone in Phase 2; PG5 grid diff tests and PG4 DiffOp plumbing are already in place.
  - The current engine-level tests only partially exercise sheet identity and ordering; they do not pin down that sheet add/remove/rename produces no spurious grid ops when grids are unchanged, nor that mixed sheet+grid changes stay cleanly separated by sheet.
  - The implementation of `diff_workbooks` already follows the intended design (keyed by `(lowercased name, SheetKind)` with deterministic ordering), so PG6 can likely be satisfied by adding fixtures and tests rather than risky algorithm changes. Codifying this behavior now reduces future regression risk as grid alignment becomes more complex.
  - Completing PG6.1–PG6.4 establishes a clear contract between the object-graph layer (sheet add/remove/rename) and the grid diff layer before introducing advanced row/column alignment (G8+), which is called out as one of the hardest technical areas (H1).
  - Recent work has focused on PG5 grid diff semantics and row/column signatures; locking down PG6 ensures later use of signatures and alignment algorithms cannot quietly change sheet-level behavior.

risks_of_deferral:
  - Advanced grid alignment (G8–G13) could inadvertently cause sheet add/remove/rename to emit bogus row/column/cell ops on unchanged sheets, and without PG6 tests there would be no guardrail to catch that regression.
  - Scenario-level behavior for common workflows (adding a sheet, renaming a sheet, or editing one sheet in a multi-sheet workbook) would remain underspecified, making it harder to reason about and debug noisy diffs later.
  - Future refactors of `diff_workbooks` or introduction of rename detection could change behavior in subtle ways; having PG6 tests now gives the reviewer a firm contract to check against.
  - Without a fixture-backed PG6 suite, the planner cannot reliably judge when Phase 2 grid responsibilities are "done", which complicates scheduling of G1–G7 MVP grid diff work.

references:
  - docs/rust_docs/excel_diff_testing_plan.md#pg6-object-graph-vs-grid-responsibilities
  - docs/rust_docs/excel_diff_specification.md (sheet/workbook diff layering and DiffOp contracts)
  - docs/rust_docs/unified_grid_diff_algorithm_specification.md (grid diff architecture and separation of object graph vs grid responsibilities)
  - docs/rust_docs/excel_diff_meta_programming.md (planner role, mini-spec requirements, phased milestones)
  - core/src/engine.rs and core/tests/engine_tests.rs (current sheet identity and diff_workbooks behavior)
  - fixtures/src/generators/grid.py and fixtures/manifest.yaml (existing grid-based fixture generation patterns)
  - docs/meta/development_history.txt entries for 2025-11-29-refactor, 2025-11-30-sheet-identity-ci, and 2025-12-01-pg5-grid-diff-baseline (context on current IR, sheet identity, and PG5 status)

difficulty_estimate:
  value: 4
  scale: "1-10, where 10 ≈ G8/G9 middle-row/column alignment with full row/column signature-based AMR algorithm."
  hardest_milestone: "G8/G9 – row/column middle insertion/deletion with signature-based alignment and move detection."