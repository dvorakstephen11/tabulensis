2025-12-07
- Reviewed mini-spec at docs/meta/plans/2025-12-06d-g13-fuzzy-row-move/spec.md and decision.yaml; confirmed scope/test requirements for G13 fuzzy row block moves.
- Re-read implementer guidance in docs/rust_docs/excel_diff_meta_programming.md Section 4 and noted constraints (size guards, determinism, no public API changes).
- Implemented detect_fuzzy_row_block_move in core/src/row_alignment.rs with size/repetition/low-info guards, ambiguous-candidate bail-out, and similarity that combines row-hash Jaccard with positional smoothing to keep small lightly edited blocks above the 0.80 threshold.
- Added unit coverage in core/src/row_alignment.rs for fuzzy detection success, low-similarity rejection, repetition guard, and identical grid no-op.
- Integrated fuzzy move fast-path into core/src/engine.rs and emit_moved_row_block_edits to surface CellEdited ops inside moved blocks.
- Introduced RowFuzzyMoveG13Generator, registered it in fixtures/src/generate.py, updated fixtures/manifest.yaml with g13_fuzzy_row_move, and generated grid_move_and_edit_a.xlsx/grid_move_and_edit_b.xlsx.
- Added workbook tests core/tests/g13_fuzzy_row_move_grid_workbook_tests.rs (positive fuzzy move, in-place edit guard, heavy repetition ambiguity guard) and tidied clippy warnings in rect block move tests/helpers.
- Ran cargo fmt, cargo clippy --all-targets (clean), and cargo test (full suite) successfully.

## Intentional Spec Deviations

| Spec Detail | Actual Implementation | Rationale |
|-------------|----------------------|-----------|
| Fuzzy similarity uses set-based Jaccard on row tokens with 0.80 threshold | Added positional match smoothing (max of Jaccard and smoothed positional match ratio) before applying the 0.80 threshold | Pure set Jaccard penalizes small blocks with a single edited row; smoothing preserves the intended positive G13 case while keeping guardrails and threshold intact |
