# Activity Log: 2025-12-19c-db-mode-workbook-tests

## Summary

This cycle adds fixture support for D2-D4 database mode tests and creates fixture-backed integration tests.

## Changes Made

### 1. fixtures/src/generators/database.py

Extended `KeyedTableGenerator` to support an `updates` argument for modifying specific rows by ID. The updates are applied by ID lookup after base data generation, before any shuffle operation.

### 2. fixtures/manifest.yaml

Added new scenario entries:
- `db_row_update_b` - for D3 row update test (ID 7 Amount changed to 120)
- `db_reorder_and_change_b` - for D4 reorder+change test (shuffle=true + same update)

### 3. fixtures/generated/

Regenerated all fixtures. New files created:
- `db_row_update_b.xlsx` - ordered table with single cell edit
- `db_reorder_and_change_b.xlsx` - shuffled table with single cell edit

### 4. core/tests/d2_d4_database_mode_workbook_tests.rs

Created new test file with 4 fixture-backed tests:
- `d2_row_added_emits_row_added_only` - uses db_equal_ordered_a.xlsx vs db_row_added_b.xlsx
- `d2_row_removed_emits_row_removed_only` - uses db_row_added_b.xlsx vs db_equal_ordered_a.xlsx (swapped)
- `d3_row_update_emits_cell_edited_only` - uses db_equal_ordered_a.xlsx vs db_row_update_b.xlsx
- `d4_reorder_and_change_emits_cell_edited_only` - uses db_equal_ordered_a.xlsx vs db_reorder_and_change_b.xlsx

All tests use `find_row_by_id` helper to locate rows dynamically without hardcoding indices.

## Key Decisions

- Created separate test file `d2_d4_database_mode_workbook_tests.rs` rather than extending `d1_database_mode_tests.rs` for clarity
- Used helper functions (`find_row_by_id`, `count_ops`, `data_grid`, `diff_db`) following patterns from existing tests
- Test assertions verify exact op counts and precise field values per the behavioral contract

## Verification

- All 4 new tests pass
- All 19 existing D1 database mode tests pass
- `cargo fmt --check` passes
- `cargo clippy --all-targets` passes (pre-existing warnings only)
- Full test suite passes

## Open Questions / Future Work

None for this cycle.

