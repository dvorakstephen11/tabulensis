2025-12-02
- Reviewed mini-spec, decision record, and implementer guide section 4 for hashing requirements.
- Switched row/column signatures to XXHash64 with fixed seed and explicit position + type tagging via hash_cell_with_position helper.
- Reworked signature computation to sort non-empty cells for deterministic hashing; compute_all_signatures now hashes rows/cols in sorted passes over cloned cells (O(M log M) due to ordering requirement).
- Added xxhash-rust dependency and helper constant XXH64_SEED.
- Expanded signature tests for position sensitivity, type discrimination, sparse empties, and a golden constant (8394164658571930929); added sparse grid sanity check for non-zero hashes.
- Updated docs/rust_docs/2025-11-30-docs-vs-implementation.md preprocessing section and priority order to reflect XXHash64, position/type coverage.
- Tooling: ran cargo fmt, cargo clippy, and cargo test (all passing); fixed clippy warnings about unused mut and Xxh64 constructor typo.

## Remediation Round 1 (2025-12-02)
- Addressed: Constraint Violation - Unnecessary Allocations in compute_all_signatures.
- Changes: core/src/workbook.rs now hashes row/col signatures over references (`Vec<&Cell>`) to avoid per-cell cloning while preserving the sorted iteration order for determinism.
- Tests: cargo fmt; cargo fmt --check; cargo clippy --all-targets --all-features; cargo test; cargo build.
- Complications: None; existing signature and sparse grid tests confirm behavior unchanged aside from allocation reduction.
## Remediation Round 2 (2025-12-02)
- Addressed Findings 3-7: formula hashing coverage, column invariants/sparsity, bulk vs per-row/col parity, and documented deferred O(k) performance expectations.
- Changes: compute_all_signatures now streams over sparse cells with a commutative mix (no sorting or cloning) shared with compute_row/compute_col; added formula inclusion, column invariants, and bulk-consistency tests plus a formula-inclusive golden; updated spec and docs-vs-implementation to record the commutative reduction and O(k) deferral.
- Tests: cargo fmt; cargo clippy --all-targets --all-features; cargo test; cargo build.
- Complications: None; golden hashes refreshed after the hashing reduction change.

## Remediation Round 3 (2025-12-02)
- Addressed: Finding 2 (docs/spec wording on commutative reduction), Finding 3 (iteration-order independence tests), Finding 4 (explicit Grid bounds invariants), Finding 5 (compute_all_signatures recomputation behavior).
- Changes: Updated spec.md and docs-vs-implementation to describe the commutative reduction/determinism model; added debug_assert bounds checks and documented Grid invariants in core/src/workbook.rs; added insertion-order independence and recomputation tests in core/tests/signature_tests.rs.
- Tests: cargo fmt; cargo clippy --all-targets --all-features; cargo test.
- Complications: None; golden signature constants unchanged.
